---
description: 
globs: 
alwaysApply: true
---
---
description: >
  RÃ¨gles spÃ©cifiques pour interagir avec le DOM de YouTube sans compromettre la stabilitÃ© ou la compatibilitÃ© de lâ€™extension.
globs:
  - "src/content/**/*.ts"
alwaysApply: true
---

## ğŸ¬ Manipulation du DOM YouTube

- Ne jamais supposer que le DOM est chargÃ© : toujours utiliser un `waitForElement(selector)` ou un `MutationObserver`.
- Les `querySelector` doivent Ãªtre robustes : Ã©viter les sÃ©lecteurs trop spÃ©cifiques ou instables.
- Ã‰viter les `setTimeout` pour attendre le DOM ; prÃ©fÃ©rer des observers rÃ©actifs.
- Ne jamais injecter de HTML : uniquement manipuler les Ã©lÃ©ments existants.

## ğŸ“¹ QualitÃ© vidÃ©o

- Utiliser les API internes YouTube (comme `player.getAvailableQualityLevels()`) si disponibles.
- Si indisponibles, modifier le menu qualitÃ© via des Ã©vÃ©nements DOM simulÃ©s uniquement si lâ€™utilisateur nâ€™interagit pas.
- Ne pas modifier la qualitÃ© si la vidÃ©o est en pause ou si lâ€™utilisateur a changÃ© la qualitÃ© manuellement rÃ©cemment (dans les 60 derniÃ¨res secondes).

## ğŸ§ª Fallbacks

- Si le DOM ne contient pas les Ã©lÃ©ments nÃ©cessaires aprÃ¨s 5 secondes, logger une erreur (`console.warn`) mais ne pas planter.
- PrÃ©voir un systÃ¨me de retry espacÃ© ou une boucle de vÃ©rification limitÃ©e dans le temps.

